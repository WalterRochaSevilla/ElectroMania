<div class="usuarios-admin-container">
  <div class="pagina-usuarios" [class.modo-claro]="!modoOscuro">
    <!-- HEADER -->
    <header class="header-usuarios">
      <div class="logo">
        <img src="LogoProvisorio.png" alt="Electroman√≠a" />
      </div>

      <nav class="menu-superior">
        <a href="#" class="menu-item" routerLink="/admin/dashboard">
          Dashboard
        </a>
        <a href="#" class="menu-item" routerLink="/admin/productos">
          Productos
        </a>
        <a href="#" class="menu-item" routerLink="/admin/usuarios">
          Usuarios
          <span class="linea-usuarios"></span>
        </a>
      </nav>

      <div class="acciones-header">
        <button class="toggle-modo" (click)="cambiarModo()">
          {{ modoOscuro ? '‚òÄÔ∏è' : 'üåô' }}
        </button>
        <button class="btn-ingresar" (click)="cerrarSesion()">Cerrar Sesi√≥n</button>
      </div>
    </header>

    <!-- CONTENIDO PRINCIPAL -->
    <main class="main-usuarios">
      <div class="encabezado-seccion">
        <h1>Gesti√≥n de Usuarios</h1>
        <div class="acciones-superiores">
          <!-- ‚úÖ SOLO ADMIN PUEDE CREAR NUEVOS USUARIOS -->
          <button class="btn-agregar" (click)="agregarUsuario()" *ngIf="authService.canCreate()">
            + Nuevo Usuario
          </button>
          
          <!-- ‚úÖ MENSAJE PARA EMPLEADOS (cuando no pueden crear) -->
          <div *ngIf="authService.isEmployee() && !authService.canCreate()" class="permission-message">
            <small>üìã Solo administradores pueden agregar usuarios</small>
          </div>
          
          <div class="buscador-usuarios">
            <input 
              type="text" 
              placeholder="Buscar usuario..." 
              [(ngModel)]="busqueda"
              (input)="filtrarUsuarios()"
            />
            <span class="icono-buscar">üîç</span>
          </div>
        </div>
      </div>

      <!-- TABLA DE USUARIOS -->
      <div class="tabla-container">
        <table class="tabla-usuarios">
          <thead>
            <tr>
              <th>USUARIO</th>
              <th>ROL</th>
              <th>NIT/CI</th>
              <th>ESTADO</th>
              <th>ACCIONES</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let usuario of usuariosFiltrados">
              <td>
                <div class="info-usuario-cell">
                  <div class="avatar-usuario">
                    {{ obtenerIniciales(usuario.nombre) }}
                  </div>
                  <div class="datos-usuario">
                    <div class="nombre-usuario">{{ usuario.nombre }}</div>
                    <div class="email-usuario">{{ usuario.email }}</div>
                  </div>
                </div>
              </td>
              <td>
                <span class="badge-rol" [class]="'rol-' + usuario.rol.toLowerCase()">
                  {{ usuario.rol }}
                </span>
              </td>
              <td class="documento-usuario">{{ usuario.nitCi }}</td>
              <td>
                <!-- ‚úÖ SOLO ADMIN PUEDE CAMBIAR ESTADO (pero el badge se muestra siempre) -->
                <span class="badge-estado" 
                      [class.activo]="usuario.estado === 'Activo'" 
                      [class.inactivo]="usuario.estado === 'Inactivo'"
                      [style.cursor]="authService.canEdit() ? 'pointer' : 'default'"
                      [style.opacity]="authService.canEdit() ? '1' : '0.6'">
                  <span class="punto-estado"></span>
                  {{ usuario.estado }}
                </span>
              </td>
              <td>
                <div class="acciones-cell">
                  <!-- ‚úÖ SOLO ADMIN PUEDE EDITAR -->
                  <button class="btn-editar" 
                          (click)="editarUsuario(usuario)" 
                          title="Editar" 
                          *ngIf="authService.canEdit()">
                    ‚úèÔ∏è
                  </button>
                  
                  <!-- ‚úÖ SOLO ADMIN PUEDE ELIMINAR -->
                  <button class="btn-eliminar" 
                          (click)="eliminarUsuario(usuario.id)" 
                          title="Eliminar" 
                          *ngIf="authService.canDelete()">
                    üóëÔ∏è
                  </button>
                  
                  <!-- ‚úÖ SOLO ADMIN PUEDE CAMBIAR ESTADO -->
                  <button class="btn-toggle" 
                          (click)="authService.canEdit() ? toggleEstado(usuario) : null" 
                          [title]="usuario.estado === 'Activo' ? 'Desactivar' : 'Activar'" 
                          [style.cursor]="authService.canEdit() ? 'pointer' : 'not-allowed'"
                          [style.opacity]="authService.canEdit() ? '1' : '0.6'">
                    {{ usuario.estado === 'Activo' ? '‚òâ' : '‚óã' }}
                  </button>
                  
                  <!-- ‚úÖ SOLO ADMIN PUEDE RESETEAR CONTRASE√ëA -->
                  <button class="btn-reset" 
                          (click)="authService.canEdit() ? resetPassword(usuario.id) : null" 
                          title="Resetear Contrase√±a"
                          [style.cursor]="authService.canEdit() ? 'pointer' : 'not-allowed'"
                          [style.opacity]="authService.canEdit() ? '1' : '0.6'">
                    üîÑ
                  </button>
                  
                  <!-- ‚úÖ MENSAJE PARA EMPLEADOS (cuando no pueden realizar acciones) -->
                  <div *ngIf="authService.isEmployee() && !authService.canEdit()" class="employee-message">
                    <small>Solo visualizaci√≥n</small>
                  </div>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- FILTROS Y ESTAD√çSTICAS -->
      <div class="filtros-estadisticas">
        <div class="filtros-rapidos">
          <button class="btn-filtro" [class.activo]="filtroRol === 'all'" (click)="aplicarFiltroRol('all')">
            Todos
          </button>
          <button class="btn-filtro" [class.activo]="filtroRol === 'Admin'" (click)="aplicarFiltroRol('Admin')">
            Administradores
          </button>
          <button class="btn-filtro" [class.activo]="filtroRol === 'Vendedor'" (click)="aplicarFiltroRol('Vendedor')">
            Vendedores
          </button>
          <button class="btn-filtro" [class.activo]="filtroRol === 'Cliente'" (click)="aplicarFiltroRol('Cliente')">
            Clientes
          </button>
        </div>

        <div class="estadisticas">
          <div class="estadistica-item">
            <span class="estadistica-label">Total:</span>
            <span class="estadistica-valor">{{ usuarios.length }}</span>
          </div>
          <div class="estadistica-item">
            <span class="estadistica-label">Activos:</span>
            <span class="estadistica-valor activos">{{ contarActivos() }}</span>
          </div>
          <div class="estadistica-item">
            <span class="estadistica-label">Inactivos:</span>
            <span class="estadistica-valor inactivos">{{ contarInactivos() }}</span>
          </div>
        </div>
      </div>
    </main>
  </div>
</div>